<aside class="w-80 border-l overflow-y-auto bg-white hidden lg:block" 
       style="border-color: var(--border-color); background-color: var(--bg-sidebar); height: calc(100vh - 80px);">
    <div class="p-4">
        <!-- Sidebar Header -->
        <div class="mb-4">
            <h3 class="font-bold text-lg" style="color: var(--accent-color); font-family: var(--font-ui);">
                فهرس المحتويات
            </h3>
        </div>
        
        <!-- Search Bar -->
        <div class="mb-4 relative">
            <input type="text" 
                   id="toc-search" 
                   placeholder="ابحث في فهرس المحتويات ..." 
                   class="w-full p-2 pl-9 rounded-lg border text-sm transition-colors"
                   style="border-color: var(--border-color); font-family: var(--font-ui); background-color: var(--bg-paper); color: var(--text-main);"
                   onfocus="this.style.borderColor = 'var(--accent-color)';"
                   onblur="this.style.borderColor = 'var(--border-color)';">
            <div class="absolute top-2.5 left-3 text-gray-400">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                </svg>
            </div>
        </div>
        
        <!-- Table of Contents List -->
        <ul class="space-y-2" style="font-family: var(--font-ui);">
            <!-- Chapter 1 - Active -->
            <li>
                <a href="#intro" 
                   class="block p-3 rounded-lg transition-colors" 
                   style="background-color: var(--accent-light); color: var(--accent-color);">
                    <div class="flex justify-between items-center">
                        <span class="font-medium">المقدمة</span>
                        <span class="text-sm opacity-75">ص 1</span>
                    </div>
                </a>
            </li>
            
            <!-- Chapter 2 -->
            <li>
                <a href="#ch1" 
                   class="block p-3 rounded-lg hover:bg-gray-50 transition-colors" 
                   style="color: var(--text-main);">
                    <div class="flex justify-between items-center">
                        <span class="font-medium">شروط المفتي وأحكامه</span>
                        <span class="text-sm opacity-75">ص 16</span>
                    </div>
                </a>
            </li>
            
            <!-- Chapter 3 -->
            <li>
                <a href="#ch2" 
                   class="block p-3 rounded-lg hover:bg-gray-50 transition-colors" 
                   style="color: var(--text-main);">
                    <div class="flex justify-between items-center">
                        <span class="font-medium">آداب المستفتي</span>
                        <span class="text-sm opacity-75">ص 31</span>
                    </div>
                </a>
            </li>
            
            <!-- Chapter 4 -->
            <li>
                <a href="#ch3" 
                   class="block p-3 rounded-lg hover:bg-gray-50 transition-colors" 
                   style="color: var(--text-main);">
                    <div class="flex justify-between items-center">
                        <span class="font-medium">أصول الإفتاء والاجتهاد</span>
                        <span class="text-sm opacity-75">ص 46</span>
                    </div>
                </a>
            </li>
            
            <!-- Chapter 5 -->
            <li>
                <a href="#ch4" 
                   class="block p-3 rounded-lg hover:bg-gray-50 transition-colors" 
                   style="color: var(--text-main);">
                    <div class="flex justify-between items-center">
                        <span class="font-medium">قواعد الفتوى والترجيح</span>
                        <span class="text-sm opacity-75">ص 61</span>
                    </div>
                </a>
            </li>
            
            <!-- Chapter 6 -->
            <li>
                <a href="#ch5" 
                   class="block p-3 rounded-lg hover:bg-gray-50 transition-colors" 
                   style="color: var(--text-main);">
                    <div class="flex justify-between items-center">
                        <span class="font-medium">النوازل والمستجدات</span>
                        <span class="text-sm opacity-75">ص 76</span>
                    </div>
                </a>
            </li>
            <li>
                <a href="#ch5" 
                   class="block p-3 rounded-lg hover:bg-gray-50 transition-colors" 
                   style="color: var(--text-main);">
                    <div class="flex justify-between items-center">
                        <span class="font-medium">النوازل والمستجدات</span>
                        <span class="text-sm opacity-75">ص 76</span>
                    </div>
                </a>
            </li>
            <li>
                <a href="#ch5" 
                   class="block p-3 rounded-lg hover:bg-gray-50 transition-colors" 
                   style="color: var(--text-main);">
                    <div class="flex justify-between items-center">
                        <span class="font-medium">النوازل والمستجدات</span>
                        <span class="text-sm opacity-75">ص 76</span>
                    </div>
                </a>
            </li>
            <li>
                <a href="#ch5" 
                   class="block p-3 rounded-lg hover:bg-gray-50 transition-colors" 
                   style="color: var(--text-main);">
                    <div class="flex justify-between items-center">
                        <span class="font-medium">النوازل والمستجدات</span>
                        <span class="text-sm opacity-75">ص 76</span>
                    </div>
                </a>
            </li>
            <li>
                <a href="#ch5" 
                   class="block p-3 rounded-lg hover:bg-gray-50 transition-colors" 
                   style="color: var(--text-main);">
                    <div class="flex justify-between items-center">
                        <span class="font-medium">النوازل والمستجدات</span>
                        <span class="text-sm opacity-75">ص 76</span>
                    </div>
                </a>
            </li>
            <li>
                <a href="#ch5" 
                   class="block p-3 rounded-lg hover:bg-gray-50 transition-colors" 
                   style="color: var(--text-main);">
                    <div class="flex justify-between items-center">
                        <span class="font-medium">النوازل والمستجدات</span>
                        <span class="text-sm opacity-75">ص 76</span>
                    </div>
                </a>
            </li>
            <li>
                <a href="#ch5" 
                   class="block p-3 rounded-lg hover:bg-gray-50 transition-colors" 
                   style="color: var(--text-main);">
                    <div class="flex justify-between items-center">
                        <span class="font-medium">النوازل والمستجدات</span>
                        <span class="text-sm opacity-75">ص 76</span>
                    </div>
                </a>
            </li>
            <li>
                <a href="#ch5" 
                   class="block p-3 rounded-lg hover:bg-gray-50 transition-colors" 
                   style="color: var(--text-main);">
                    <div class="flex justify-between items-center">
                        <span class="font-medium">النوازل والمستجدات</span>
                        <span class="text-sm opacity-75">ص 76</span>
                    </div>
                </a>
            </li>
            <li>
                <a href="#ch5" 
                   class="block p-3 rounded-lg hover:bg-gray-50 transition-colors" 
                   style="color: var(--text-main);">
                    <div class="flex justify-between items-center">
                        <span class="font-medium">النوازل والمستجدات</span>
                        <span class="text-sm opacity-75">ص 76</span>
                    </div>
                </a>
            </li>
            <li>
                <a href="#ch5" 
                   class="block p-3 rounded-lg hover:bg-gray-50 transition-colors" 
                   style="color: var(--text-main);">
                    <div class="flex justify-between items-center">
                        <span class="font-medium">النوازل والمستجدات</span>
                        <span class="text-sm opacity-75">ص 76</span>
                    </div>
                </a>
            </li><li>
                <a href="#ch5" 
                   class="block p-3 rounded-lg hover:bg-gray-50 transition-colors" 
                   style="color: var(--text-main);">
                    <div class="flex justify-between items-center">
                        <span class="font-medium">النوازل والمستجدات</span>
                        <span class="text-sm opacity-75">ص 76</span>
                    </div>
                </a>
            </li>
            <li>
                <a href="#ch5" 
                   class="block p-3 rounded-lg hover:bg-gray-50 transition-colors" 
                   style="color: var(--text-main);">
                    <div class="flex justify-between items-center">
                        <span class="font-medium">النوازل والمستجدات</span>
                        <span class="text-sm opacity-75">ص 76</span>
                    </div>
                </a>
            </li>
            <li>
                <a href="#ch5" 
                   class="block p-3 rounded-lg hover:bg-gray-50 transition-colors" 
                   style="color: var(--text-main);">
                    <div class="flex justify-between items-center">
                        <span class="font-medium">النوازل والمستجدات</span>
                        <span class="text-sm opacity-75">ص 76</span>
                    </div>
                </a>
            </li>
            <li>
                <a href="#ch5" 
                   class="block p-3 rounded-lg hover:bg-gray-50 transition-colors" 
                   style="color: var(--text-main);">
                    <div class="flex justify-between items-center">
                        <span class="font-medium">النوازل والمستجدات</span>
                        <span class="text-sm opacity-75">ص 76</span>
                    </div>
                </a>
            </li><li>
                <a href="#ch5" 
                   class="block p-3 rounded-lg hover:bg-gray-50 transition-colors" 
                   style="color: var(--text-main);">
                    <div class="flex justify-between items-center">
                        <span class="font-medium">النوازل والمستجدات</span>
                        <span class="text-sm opacity-75">ص 76</span>
                    </div>
                </a>
            </li><li>
                <a href="#ch5" 
                   class="block p-3 rounded-lg hover:bg-gray-50 transition-colors" 
                   style="color: var(--text-main);">
                    <div class="flex justify-between items-center">
                        <span class="font-medium">النوازل والمستجدات</span>
                        <span class="text-sm opacity-75">ص 76</span>
                    </div>
                </a>
            </li><li>
                <a href="#ch5" 
                   class="block p-3 rounded-lg hover:bg-gray-50 transition-colors" 
                   style="color: var(--text-main);">
                    <div class="flex justify-between items-center">
                        <span class="font-medium">النوازل والمستجدات</span>
                        <span class="text-sm opacity-75">ص 76</span>
                    </div>
                </a>
            </li>
            <li>
                <a href="#ch5" 
                   class="block p-3 rounded-lg hover:bg-gray-50 transition-colors" 
                   style="color: var(--text-main);">
                    <div class="flex justify-between items-center">
                        <span class="font-medium">النوازل والمستجدات</span>
                        <span class="text-sm opacity-75">ص 76</span>
                    </div>
                </a>
            </li>

        </ul>
        
        <!-- Reading Progress Section 
        <div class="mt-8 pt-4 border-t" style="border-color: var(--border-color);">
            <div class="mb-2">
                <div class="flex justify-between items-center text-sm" style="font-family: var(--font-ui); color: var(--text-secondary);">
                    <span>تقدم القراءة</span>
                    <span style="color: var(--accent-color); font-weight: bold;">8%</span>
                </div>
            </div>
            <div class="w-full bg-gray-200 rounded-full h-2">
                <div class="h-2 rounded-full transition-all duration-300" 
                     style="width: 8%; background-color: var(--accent-color);"></div>
            </div>
            <div class="mt-2 text-xs text-center" style="color: var(--text-muted); font-family: var(--font-ui);">
                صفحة 10 من 120
            </div>
        </div>
        -->
        <!-- Book Info Section 
        <div class="mt-6 p-4 rounded-lg border" style="border-color: var(--border-color); background-color: var(--bg-paper);">
            <h4 class="font-bold mb-3 text-sm" style="color: var(--accent-color); font-family: var(--font-ui);">
                معلومات الكتاب
            </h4>
            <div class="space-y-2 text-xs" style="font-family: var(--font-ui); color: var(--text-secondary);">
                <div class="flex justify-between">
                    <span>المؤلف:</span>
                    <span class="font-medium" style="color: var(--text-main);">الإمام النووي</span>
                </div>
                <div class="flex justify-between">
                    <span>عدد الصفحات:</span>
                    <span class="font-medium" style="color: var(--text-main);">120</span>
                </div>
                <div class="flex justify-between">
                    <span>القسم:</span>
                    <span class="font-medium" style="color: var(--text-main);">أصول الفقه</span>
                </div>
                <div class="flex justify-between">
                    <span>سنة النشر:</span>
                    <span class="font-medium" style="color: var(--text-main);">1420هـ</span>
                </div>
            </div>
           
        </div>
        -->
    </div>
</aside>

<!-- Mobile Sidebar Overlay -->
<div class="fixed inset-0 bg-black bg-opacity-50 z-40 lg:hidden hidden" id="sidebar-overlay">
    <aside class="w-80 h-full bg-white overflow-y-auto" style="background-color: var(--bg-sidebar);">
        <div class="p-4">
            <!-- Close Button -->
            <div class="flex justify-between items-center mb-4">
                <h3 class="font-bold text-lg" style="color: var(--accent-color); font-family: var(--font-ui);">
                    فهرس المحتويات
                </h3>
                <button class="p-2 rounded-lg hover:bg-gray-100 transition-colors" id="close-sidebar">
                    <svg class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Mobile Search Bar -->
            <div class="mb-4 relative">
                <input type="text" 
                       id="toc-search-mobile" 
                       placeholder="الذهاب الى..." 
                       class="w-full p-2 pl-9 rounded-lg border text-sm transition-colors"
                       style="border-color: var(--border-color); font-family: var(--font-ui); background-color: var(--bg-paper); color: var(--text-main);"
                       onfocus="this.style.borderColor = 'var(--accent-color)';"
                       onblur="this.style.borderColor = 'var(--border-color)';">
                <div class="absolute top-2.5 left-3 text-gray-400">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                    </svg>
                </div>
            </div>

            <!-- Mobile Table of Contents List -->
            <ul class="space-y-2 mobile-toc-list" style="font-family: var(--font-ui);">
                <!-- Same content as desktop sidebar -->
                <li>
                    <a href="#intro" 
                       class="block p-3 rounded-lg transition-colors" 
                       style="background-color: var(--accent-light); color: var(--accent-color);">
                        <div class="flex justify-between items-center">
                            <span class="font-medium">المقدمة</span>
                            <span class="text-sm opacity-75">ص 1</span>
                        </div>
                    </a>
                </li>
                <li>
                    <a href="#ch1" class="block p-3 rounded-lg hover:bg-gray-50 transition-colors" style="color: var(--text-main);">
                        <div class="flex justify-between items-center"><span class="font-medium">شروط المفتي وأحكامه</span><span class="text-sm opacity-75">ص 16</span></div>
                    </a>
                </li>
                <li>
                    <a href="#ch2" class="block p-3 rounded-lg hover:bg-gray-50 transition-colors" style="color: var(--text-main);">
                        <div class="flex justify-between items-center"><span class="font-medium">آداب المستفتي</span><span class="text-sm opacity-75">ص 31</span></div>
                    </a>
                </li>
                <li>
                    <a href="#ch3" class="block p-3 rounded-lg hover:bg-gray-50 transition-colors" style="color: var(--text-main);">
                        <div class="flex justify-between items-center"><span class="font-medium">أصول الإفتاء والاجتهاد</span><span class="text-sm opacity-75">ص 46</span></div>
                    </a>
                </li>
                 <li>
                    <a href="#ch4" class="block p-3 rounded-lg hover:bg-gray-50 transition-colors" style="color: var(--text-main);">
                        <div class="flex justify-between items-center"><span class="font-medium">قواعد الفتوى والترجيح</span><span class="text-sm opacity-75">ص 61</span></div>
                    </a>
                </li>
                <li>
                    <a href="#ch5" class="block p-3 rounded-lg hover:bg-gray-50 transition-colors" style="color: var(--text-main);">
                        <div class="flex justify-between items-center"><span class="font-medium">النوازل والمستجدات</span><span class="text-sm opacity-75">ص 76</span></div>
                    </a>
                </li>
            </ul>
        </div>
    </aside>
</div>

<!-- Mobile Search Sidebar Overlay -->
<div class="fixed inset-0 bg-black bg-opacity-50 z-50 lg:hidden hidden" id="search-sidebar-overlay">
    <aside class="w-80 h-full bg-white overflow-y-auto" style="background-color: var(--bg-sidebar);">
        <div class="p-4">
            <!-- Close Button & Title -->
            <div class="flex justify-between items-center mb-4">
                <h3 class="font-bold text-lg" style="color: var(--accent-color); font-family: var(--font-ui);">
                    البحث داخل الكتاب
                </h3>
                <button class="p-2 rounded-lg hover:bg-gray-100 transition-colors" id="close-search-sidebar">
                    <svg class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Search Bar + Filter -->
            <div class="mb-4 flex gap-2">
                <div class="relative flex-1">
                    <input type="text" 
                           id="book-search-mobile" 
                           placeholder="ابحث عن كلمة..." 
                           class="w-full p-2 pl-9 rounded-lg border text-sm transition-colors"
                           style="border-color: var(--border-color); font-family: var(--font-ui); background-color: var(--bg-paper); color: var(--text-main);"
                           onfocus="this.style.borderColor = 'var(--accent-color)';"
                           onblur="this.style.borderColor = 'var(--border-color)';">
                    <div class="absolute top-2.5 left-3 text-gray-400">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                        </svg>
                    </div>
                </div>
                <!-- Filter Button -->
                <button class="p-2 rounded-lg border hover:bg-gray-50 transition-colors" 
                        style="border-color: var(--border-color); background-color: var(--bg-paper); color: var(--text-secondary);"
                        title="تصفية النتائج">
                     <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M3 6h18M6 12h12M10 18h4"/></svg>
                </button>
            </div>

            <!-- Search Results Placeholder -->
            <div id="search-results-area" class="space-y-2" style="font-family: var(--font-ui);">
                <div class="p-3 text-center text-sm text-gray-500">
                    اكتب كلمة للبحث...
                </div>
            </div>
        </div>
    </aside>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const menuToggle = document.getElementById('menu-toggle');
    const sidebarOverlay = document.getElementById('sidebar-overlay');
    const closeSidebar = document.getElementById('close-sidebar');
    
    // Search Sidebar Elements
    const searchSidebarOverlay = document.getElementById('search-sidebar-overlay');
    const closeSearchSidebar = document.getElementById('close-search-sidebar');
    
    // Toggle Sidebar (TOC)
    if(menuToggle) {
        menuToggle.addEventListener('click', function() {
            sidebarOverlay.classList.remove('hidden');
            if(searchSidebarOverlay) searchSidebarOverlay.classList.add('hidden'); // Close search sidebar if open
        });
    }
    
    // Close Sidebar (TOC)
    if(closeSidebar) {
        closeSidebar.addEventListener('click', function() {
            sidebarOverlay.classList.add('hidden');
        });
    }
    
    // Close Search Sidebar
    if(closeSearchSidebar) {
        closeSearchSidebar.addEventListener('click', function() {
            searchSidebarOverlay.classList.add('hidden');
        });
    }
    
    // Close on click outside (TOC)
    sidebarOverlay.addEventListener('click', function(e) {
        if(e.target === sidebarOverlay) {
            sidebarOverlay.classList.add('hidden');
        }
    });

    // Close on click outside (Search Sidebar)
    searchSidebarOverlay?.addEventListener('click', function(e) {
        if(e.target === searchSidebarOverlay) {
            searchSidebarOverlay.classList.add('hidden');
        }
    });

    // TOC Search Logic (Desktop)
    const searchInput = document.getElementById('toc-search');
    const tocList = document.querySelector('.p-4 > ul.space-y-2'); 

    if(searchInput && tocList) {
        const items = tocList.querySelectorAll('li');
        searchInput.addEventListener('input', function(e) {
            filterItems(e.target.value, items);
        });
    }

    // TOC Search Logic (Mobile)
    const searchInputMobile = document.getElementById('toc-search-mobile');
    const tocListMobile = document.querySelector('.mobile-toc-list');
    
    if(searchInputMobile && tocListMobile) {
        const itemsMobile = tocListMobile.querySelectorAll('li');
        searchInputMobile.addEventListener('input', function(e) {
            filterItems(e.target.value, itemsMobile);
        });
    }

    // Shared filter function
    function filterItems(val, items) {
        const term = val.trim().toLowerCase();
        items.forEach(item => {
            const text = item.textContent.toLowerCase();
            if(text.includes(term)) {
                item.style.display = '';
            } else {
                item.style.display = 'none';
            }
        });
    }
});
</script>