# ุณูุฑูุจุช ุณุญุจ ูุญุชูู ูุชุงุจ ูู Turath.io

## ูุธุฑุฉ ุนุงูุฉ

ูุฐุง ุงููุณุชูุฏ ูุญุชูู ุนูู ุชุญููู ุดุงูู ูููุฏ ูุงูู ูุณูุฑูุจุช Node.js ูุณุญุจ ูุญุชูู ุงููุชุจ ูู ูููุน Turath.io ุจุงุณุชุฎุฏุงู ุงูู API ุงูุฏุงุฎููุฉ ุงูููุชุดูุฉ.

---

## ๐ ุงููุชุทูุจุงุช ุงูุชูููุฉ

### ุงูุจูุฆุฉ ุงููุทููุจุฉ

- **Node.js**: ุงูุฅุตุฏุงุฑ 14 ุฃู ุฃุญุฏุซ
- **ุงูููุชุจุงุช ุงููุทููุจุฉ**:
  - `axios`: ููุชุนุงูู ูุน HTTP requests
  - `fs/promises`: ููุชุนุงูู ูุน ุงููููุงุช (ูุฏูุฌุฉ ูู Node.js)

### ุชุซุจูุช ุงูููุชุจุงุช

```bash
npm init -y
npm install axios
```

---

## ๐ ุชุญููู ุงูู API

### 1. Endpoint ูุนูููุงุช ุงููุชุงุจ

```
GET https://api.turath.io/book?id={book_id}&include=indexes&ver=3
```

**ุงูุงุณุชุฌุงุจุฉ ุงููุนููุฉ** (ูุซุงู: ูุชุงุจ 147927):

```json
{
  "meta": {
    "id": 147927,
    "name": "ุงูุฃุฑุจุนูู ุงูููููุฉ ูุน ุฒูุงุฏุงุช ุงุจู ุฑุฌุจ",
    "type": 5,
    "printed": 3,
    "info": "ุงููุชุงุจ: ุงูุฃุฑุจุนูู ุงูููููุฉ...\nุงููุคูู: ูุญูู ุงูุฏูู ุงููููู...\nุนุฏุฏ ุงูุตูุญุงุช: ูฆูง",
    "author_id": 44,
    "cat_id": "6"
  },
  "indexes": {
    "volumes": ["1"],
    "headings": [
      {
        "title": "ุชูุฏูู ูุตุทูู ุงูุนุฏูู",
        "level": 1,
        "page": 2
      }
    ],
    "volume_bounds": {
      "1": [1, 67]
    }
  }
}
```

**ุงูุญููู ุงููููุฉ ุงูููุชุดูุฉ**:

- `meta.name`: ุงุณู ุงููุชุงุจ (ุณููุณุชุฎุฏู ูุงุณู ููููู) โ
- `meta.info`: ูุนูููุงุช ุชูุตูููุฉ (ุงููุคููุ ุงููุญููุ **ุนุฏุฏ ุงูุตูุญุงุช**) ๐ฏ
- `meta.author_id`: ูุนุฑู ุงููุคูู
- `indexes.headings`: **ููุฑุณ ุงููุชุงุจ ุงููุงูู** ูุน ุงูุนูุงููู ููุณุชููุงุชูุง ูุฃุฑูุงู ุงูุตูุญุงุช! ๐
- `indexes.volume_bounds`: **ุญุฏูุฏ ุงููุฌูุฏุงุช** - ูุนุทููุง ุงููุทุงู ุงูุฏููู ููุตูุญุงุช (ูุซูุงู: `"1": [1, 67]`) ๐ฏ
- `indexes.volumes`: ูุงุฆูุฉ ุงููุฌูุฏุงุช ุงููุชููุฑุฉ

### 2. Endpoint ูุญุชูู ุงูุตูุญุฉ

```
GET https://api.turath.io/page?book_id={book_id}&pg={page_number}&ver=3
```

**ุงูุงุณุชุฌุงุจุฉ ุงููุชููุนุฉ**:

```json
{
  "text": "ูุญุชูู ุงูุตูุญุฉ ููุง...",
  "page": 1
}
```

**ุงูุญููู ุงููููุฉ**:

- `text`: ุงููุต ุงููุนูู ููุตูุญุฉ

---

## ๐๏ธ ุงูุจููุฉ ุงููุนูุงุฑูุฉ ููุณูุฑูุจุช

### ุงูููููุงุช ุงูุฑุฆูุณูุฉ

```mermaid
graph TD
    A[ุงูุจุฏุงูุฉ] --> B[ุฌูุจ ูุนูููุงุช ุงููุชุงุจ]
    B --> C{ูุฌุญ ุงูุทูุจุ}
    C -->|ูุง| D[ุนุฑุถ ุฎุทุฃ ูุฅููุงุก]
    C -->|ูุนู| E[ุฅูุดุงุก ููู ุจุงุณู ุงููุชุงุจ]
    E --> F[ุจุฏุก ุญููุฉ ุงูุตูุญุงุช ูู 1]
    F --> G[ุฌูุจ ูุญุชูู ุงูุตูุญุฉ]
    G --> H{ูุฌุญ ุงูุทูุจุ}
    H -->|ูุง| I[ุฅููุงุก ุงูุญููุฉ]
    H -->|ูุนู| J{ุงููุต ูุงุฑุบุ}
    J -->|ูุนู| I
    J -->|ูุง| K[ุฅุถุงูุฉ ุงููุต ููููู]
    K --> L[ุงูุชุธุงุฑ 500ms]
    L --> M[ุฒูุงุฏุฉ ุฑูู ุงูุตูุญุฉ]
    M --> F
    I --> N[ุนุฑุถ ุฑุณุงูุฉ ุงููุฌุงุญ]
    N --> O[ุงูููุงูุฉ]
```

### ุงูุฏูุงู ุงูุฑุฆูุณูุฉ

1. **`getBookInfo(bookId)`**: ุฌูุจ ูุนูููุงุช ุงููุชุงุจ
2. **`getPageContent(bookId, pageNumber)`**: ุฌูุจ ูุญุชูู ุตูุญุฉ ูุญุฏุฏุฉ
3. **`sleep(ms)`**: ุงูุชุฃุฎูุฑ ุงูุฒููู ุจูู ุงูุทูุจุงุช
4. **`sanitizeFilename(filename)`**: ุชูุธูู ุงุณู ุงูููู ูู ุงูุฑููุฒ ุบูุฑ ุงููุณููุญุฉ
5. **`main()`**: ุงูุฏุงูุฉ ุงูุฑุฆูุณูุฉ ุงูุชู ุชูุณู ุงูุนูููุฉ

---

## ๐ก ุงููุฑุงุฑุงุช ุงูุชุตููููุฉ

### 1. ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก (Error Handling)

#### ุงูุณููุงุฑูููุงุช ุงููุฎุชููุฉ

| ุงูุณููุงุฑูู | ุงูุฅุฌุฑุงุก ุงููุชุฎุฐ |
|-----------|----------------|
| ูุดู ุฌูุจ ูุนูููุงุช ุงููุชุงุจ | ุฅููุงู ุงูุณูุฑูุจุช ูุนุฑุถ ุฑุณุงูุฉ ุฎุทุฃ |
| ุฎุทุฃ HTTP ูู ุตูุญุฉ (404, 500) | ุงุนุชุจุงุฑูุง ููุงูุฉ ุงููุชุงุจ |
| ุตูุญุฉ ุจูุต ูุงุฑุบ | ุงุนุชุจุงุฑูุง ููุงูุฉ ุงููุชุงุจ |
| ุฎุทุฃ ุดุจูุฉ ูุคูุช | ุฅุนุงุฏุฉ ุงููุญุงููุฉ 3 ูุฑุงุช ูุน ุชุฃุฎูุฑ ูุชุฒุงูุฏ |

#### ุขููุฉ ุฅุนุงุฏุฉ ุงููุญุงููุฉ (Retry Logic)

```javascript
// ุฅุนุงุฏุฉ ุงููุญุงููุฉ ูุน Exponential Backoff
const MAX_RETRIES = 3;
const BASE_DELAY = 1000; // 1 ุซุงููุฉ

for (let attempt = 1; attempt <= MAX_RETRIES; attempt++) {
  try {
    // ูุญุงููุฉ ุงูุทูุจ
    return await axios.get(url);
  } catch (error) {
    if (attempt === MAX_RETRIES) throw error;
    await sleep(BASE_DELAY * Math.pow(2, attempt - 1));
  }
}
```

### 2. ุงูุชุฃุฎูุฑ ุงูุฒููู (Rate Limiting)

**ุงููููุฉ ุงููุฎุชุงุฑุฉ**: 500ms ุจูู ูู ุทูุจ

**ุงูุฃุณุจุงุจ**:

- โ ูุงูู ูุชุฌูุจ ุงูุญุธุฑ ูู ูุนุธู ุงูุฎูุงุฏู
- โ ููุณ ุทูููุงู ุฌุฏุงู (ูุชุงุจ ูู 500 ุตูุญุฉ = ~4 ุฏูุงุฆู)
- โ ูููู ุชุนุฏููู ุจุณูููุฉ ูู ุงูุซูุงุจุช

**ุงูุชุญุณููุงุช ุงูููููุฉ**:

- ุฅุถุงูุฉ ุชุฃุฎูุฑ ูุชุบูุฑ ุนูุฏ ููุงุฌูุฉ ุฎุทุฃ 429 (Too Many Requests)
- ุงุณุชุฎุฏุงู `p-queue` ููุชุญูู ุงูุฃูุถู ูู ูุนุฏู ุงูุทูุจุงุช

### 3. ุชูุณูู ุงูููู ุงูููุงุฆู

**ุงูุตูุบุฉ ุงููุฎุชุงุฑุฉ**:

```
[ูุต ุงูุตูุญุฉ 1]

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
ุตูุญุฉ 2
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

[ูุต ุงูุตูุญุฉ 2]

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
ุตูุญุฉ 3
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

[ูุต ุงูุตูุญุฉ 3]
```

**ุงููููุฒุงุช**:

- โ ูุงุตู ูุงุถุญ ุจุตุฑูุงู ุจูู ุงูุตูุญุงุช
- โ ุฑูู ุงูุตูุญุฉ ููุฌูุฏ ูููุฑุฌุนูุฉ
- โ ุณูู ุงูุจุญุซ ูุงูุชููู ูู ุงูููู

### 4. ูุนุงูุฌุฉ ุงููุต (Text Processing)

#### ุงูุชูุธููุงุช ุงููุทุจูุฉ

1. **ุฅุฒุงูุฉ HTML tags** (ุฅู ููุฌุฏุช): ุงุณุชุฎุฏุงู regex ุจุณูุท
2. **ุชูุธูู ุงููุณุงูุงุช ุงูุฒุงุฆุฏุฉ**: ุฅุฒุงูุฉ ุงูุฃุณุทุฑ ุงููุงุฑุบุฉ ุงููุชุนุฏุฏุฉ
3. **ูุนุงูุฌุฉ ุงูุชุฑููุฒ**: ุญูุธ ุจุตูุบุฉ UTF-8 ููุฏุนู ุงููุงูู ููุนุฑุจูุฉ
4. **HTML entities**: ุชุญููู `&nbsp;` ู `&amp;` ุฅูู ุฑููุฒูุง ุงูุฃุตููุฉ

```javascript
function cleanText(text) {
  return text
    .replace(/<[^>]*>/g, '')           // ุฅุฒุงูุฉ HTML tags
    .replace(/&nbsp;/g, ' ')           // ุชุญููู &nbsp;
    .replace(/&amp;/g, '&')            // ุชุญููู &amp;
    .replace(/&lt;/g, '<')             // ุชุญููู &lt;
    .replace(/&gt;/g, '>')             // ุชุญููู &gt;
    .replace(/\n{3,}/g, '\n\n')        // ุชูููู ุงูุฃุณุทุฑ ุงููุงุฑุบุฉ
    .trim();
}
```

### 5. ุงูุชูุฏู ูุงููุฑุงูุจุฉ (Progress Monitoring)

**ุงููุนูููุงุช ุงููุนุฑูุถุฉ**:

- โ ุฑุณุงูุฉ ุงูุจุฏุงูุฉ ูุน ุงุณู ุงููุชุงุจ
- โ ุชุญุฏูุซ ุจุนุฏ ูู 10 ุตูุญุงุช
- โ ุดุฑูุท ุชูุฏู ุจุณูุท (ุฅุฐุง ูุงู ุนุฏุฏ ุงูุตูุญุงุช ูุนุฑููุงู)
- โ ุฑุณุงูุฉ ุงูููุงูุฉ ูุน ุงูุฅุญุตุงุฆูุงุช

**ูุซุงู ุนูู ุงูุฅุฎุฑุงุฌ**:

```
๐ ุจุฏุก ุชุญููู ูุชุงุจ: ุตุญูุญ ุงูุจุฎุงุฑู
๐ ุนุฏุฏ ุงูุตูุญุงุช ุงููุชููุน: 500

โ ุชู ุชุญููู 10 ุตูุญุงุช...
โ ุชู ุชุญููู 20 ุตูุญุงุช...
โ ุชู ุชุญููู 30 ุตูุญุงุช...
...
โ ุชู ุชุญููู 500 ุตูุญุงุช...

โ ุงูุชูู ุงูุชุญููู!
๐ ุชู ุญูุธ 500 ุตูุญุฉ ูู: ุตุญูุญ_ุงูุจุฎุงุฑู.txt
โฑ๏ธ  ุงูููุช ุงููุณุชุบุฑู: 4 ุฏูุงุฆู ู 12 ุซุงููุฉ
```

### 6. ุงููุฑููุฉ ูู ุงูุงุณุชุฎุฏุงู

**ุทุฑููุชุงู ููุชุดุบูู**:

#### ุงูุทุฑููุฉ 1: ุชูุฑูุฑ book_id ูู argument

```bash
node turath_scraper.js 147927
```

#### ุงูุทุฑููุฉ 2: ุชุนุฏูู ุงูุซุงุจุช ูู ุงูููุฏ

```javascript
const BOOK_ID = 147927;
```

**ุงูููุฏ ูุฏุนู ููุง ุงูุทุฑููุชูู**:

```javascript
const bookId = process.argv[2] || BOOK_ID;
```

### 7. ุงุณู ุงูููู ุงูููุงุฆู

**ุขููุฉ ุงูุชุณููุฉ**:

```javascript
function sanitizeFilename(filename) {
  return filename
    .replace(/[<>:"/\\|?*]/g, '_')    // ุงุณุชุจุฏุงู ุงูุฑููุฒ ุบูุฑ ุงููุณููุญุฉ
    .replace(/\s+/g, '_')              // ุงุณุชุจุฏุงู ุงููุณุงูุงุช ุจู _
    .replace(/_{2,}/g, '_')            // ุชูููู _ ุงููุชุนุฏุฏุฉ
    .substring(0, 200);                // ุชุญุฏูุฏ ุงูุทูู ุงูุฃูุตู
}
```

**ุฃูุซูุฉ**:

- `"ุตุญูุญ ุงูุจุฎุงุฑู"` โ `ุตุญูุญ_ุงูุจุฎุงุฑู.txt`
- `"ูุชุงุจ: ุงูุฃู / ููุดุงูุนู"` โ `ูุชุงุจ_ุงูุฃู_ููุดุงูุนู.txt`

**ุฎูุงุฑ ุฅุถุงูู**: ุฅุถุงูุฉ ุงูุชุงุฑูุฎ

```javascript
const timestamp = new Date().toISOString().split('T')[0];
const filename = `${sanitizedName}_${timestamp}.txt`;
// ูุซุงู: ุตุญูุญ_ุงูุจุฎุงุฑู_2026-01-18.txt
```

---

## ๐ ุงูููุฏ ุงููุงูู

### ุงููุณุฎุฉ ุงูุฃุณุงุณูุฉ (Basic Version)

```javascript
/**
 * Turath.io Book Scraper
 * ุณูุฑูุจุช ูุณุญุจ ูุญุชูู ุงููุชุจ ูู ูููุน ุงูุชุฑุงุซ
 * 
 * ุงูุงุณุชุฎุฏุงู:
 * node turath_scraper.js [book_id]
 */

const axios = require('axios');
const fs = require('fs').promises;
const path = require('path');

// ============================================
// ุงูุซูุงุจุช (Constants)
// ============================================

const BASE_URL = 'https://api.turath.io';
const DELAY_MS = 500;                    // ุงูุชุฃุฎูุฑ ุจูู ุงูุทูุจุงุช (0.5 ุซุงููุฉ)
const DEFAULT_BOOK_ID = 147927;          // ูุนุฑู ุงููุชุงุจ ุงูุงูุชุฑุงุถู
const MAX_RETRIES = 3;                   // ุนุฏุฏ ูุญุงููุงุช ุฅุนุงุฏุฉ ุงูุทูุจ
const RETRY_DELAY = 1000;                // ุงูุชุฃุฎูุฑ ุจูู ูุญุงููุงุช ุฅุนุงุฏุฉ ุงูุทูุจ
const OUTPUT_DIR = './books';            // ูุฌูุฏ ุญูุธ ุงููุชุจ

// ============================================
// ุงูุฏูุงู ุงููุณุงุนุฏุฉ (Helper Functions)
// ============================================

/**
 * ุฏุงูุฉ ุงูุชุฃุฎูุฑ ุงูุฒููู
 * @param {number} ms - ุงููุฏุฉ ุจุงููููู ุซุงููุฉ
 */
function sleep(ms) {
  return new Promise(resolve => setTimeout(resolve, ms));
}

/**
 * ุชูุธูู ุงุณู ุงูููู ูู ุงูุฑููุฒ ุบูุฑ ุงููุณููุญุฉ
 * @param {string} filename - ุงุณู ุงูููู ุงูุฃุตูู
 * @returns {string} - ุงุณู ุงูููู ุงูููุธู
 */
function sanitizeFilename(filename) {
  return filename
    .replace(/[<>:"/\\|?*]/g, '_')     // ุงุณุชุจุฏุงู ุงูุฑููุฒ ุบูุฑ ุงููุณููุญุฉ
    .replace(/\s+/g, '_')               // ุงุณุชุจุฏุงู ุงููุณุงูุงุช
    .replace(/_{2,}/g, '_')             // ุชูููู ุงูุดุฑุทุงุช ุงูุณูููุฉ ุงููุชุนุฏุฏุฉ
    .replace(/^_+|_+$/g, '')            // ุฅุฒุงูุฉ ุงูุดุฑุทุงุช ูู ุงูุจุฏุงูุฉ ูุงูููุงูุฉ
    .substring(0, 200);                 // ุชุญุฏูุฏ ุงูุทูู ุงูุฃูุตู
}

/**
 * ุชูุธูู ุงููุต ูู HTML tags ูุงูุฑููุฒ ุงูุฎุงุตุฉ
 * @param {string} text - ุงููุต ุงูุฃุตูู
 * @returns {string} - ุงููุต ุงูููุธู
 */
function cleanText(text) {
  if (!text) return '';
  
  return text
    .replace(/<[^>]*>/g, '')            // ุฅุฒุงูุฉ HTML tags
    .replace(/&nbsp;/g, ' ')            // ุชุญููู &nbsp;
    .replace(/&amp;/g, '&')             // ุชุญููู &amp;
    .replace(/&lt;/g, '<')              // ุชุญููู &lt;
    .replace(/&gt;/g, '>')              // ุชุญููู &gt;
    .replace(/&quot;/g, '"')            // ุชุญููู &quot;
    .replace(/&#39;/g, "'")             // ุชุญููู &#39;
    .replace(/\r\n/g, '\n')             // ุชูุญูุฏ ููุงูุฉ ุงูุฃุณุทุฑ
    .replace(/\n{3,}/g, '\n\n')         // ุชูููู ุงูุฃุณุทุฑ ุงููุงุฑุบุฉ ุงููุชุนุฏุฏุฉ
    .trim();
}

/**
 * ุชูุณูู ุงูููุช ุงููุณุชุบุฑู
 * @param {number} ms - ุงูููุช ุจุงููููู ุซุงููุฉ
 * @returns {string} - ุงูููุช ููุณู
 */
function formatDuration(ms) {
  const seconds = Math.floor(ms / 1000);
  const minutes = Math.floor(seconds / 60);
  const remainingSeconds = seconds % 60;
  
  if (minutes > 0) {
    return `${minutes} ุฏูููุฉ ู ${remainingSeconds} ุซุงููุฉ`;
  }
  return `${seconds} ุซุงููุฉ`;
}

// ============================================
// ุฏูุงู ุงูู API (API Functions)
// ============================================

/**
 * ุฌูุจ ูุนูููุงุช ุงููุชุงุจ
 * @param {number} bookId - ูุนุฑู ุงููุชุงุจ
 * @returns {Promise<Object>} - ุจูุงูุงุช ุงููุชุงุจ
 */
async function getBookInfo(bookId) {
  const url = `${BASE_URL}/book?id=${bookId}&include=indexes&ver=3`;
  
  for (let attempt = 1; attempt <= MAX_RETRIES; attempt++) {
    try {
      console.log(`๐ก ุฌุงุฑู ุฌูุจ ูุนูููุงุช ุงููุชุงุจ (ูุญุงููุฉ ${attempt}/${MAX_RETRIES})...`);
      const response = await axios.get(url, {
        headers: {
          'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36',
          'Accept': 'application/json',
        },
        timeout: 10000, // 10 ุซูุงูู
      });
      
      return response.data;
    } catch (error) {
      console.error(`โ ูุดู ุงูุทูุจ: ${error.message}`);
      
      if (attempt === MAX_RETRIES) {
        throw new Error(`ูุดู ุฌูุจ ูุนูููุงุช ุงููุชุงุจ ุจุนุฏ ${MAX_RETRIES} ูุญุงููุงุช`);
      }
      
      const delay = RETRY_DELAY * Math.pow(2, attempt - 1);
      console.log(`โณ ุฅุนุงุฏุฉ ุงููุญุงููุฉ ุจุนุฏ ${delay}ms...`);
      await sleep(delay);
    }
  }
}

/**
 * ุฌูุจ ูุญุชูู ุตูุญุฉ ูุงุญุฏุฉ
 * @param {number} bookId - ูุนุฑู ุงููุชุงุจ
 * @param {number} pageNumber - ุฑูู ุงูุตูุญุฉ
 * @returns {Promise<Object|null>} - ูุญุชูู ุงูุตูุญุฉ ุฃู null ุฅุฐุง ูุดู
 */
async function getPageContent(bookId, pageNumber) {
  const url = `${BASE_URL}/page?book_id=${bookId}&pg=${pageNumber}&ver=3`;
  
  try {
    const response = await axios.get(url, {
      headers: {
        'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36',
        'Accept': 'application/json',
      },
      timeout: 10000,
    });
    
    return response.data;
  } catch (error) {
    // ุฅุฐุง ูุงู ุงูุฎุทุฃ 404 ุฃู ุฃู ุฎุทุฃ HTTP ุขุฎุฑุ ูุนุชุจุฑูุง ููุงูุฉ ุงููุชุงุจ
    if (error.response) {
      console.log(`โน๏ธ  ุงูุตูุญุฉ ${pageNumber}: ${error.response.status} - ููุงูุฉ ุงููุชุงุจ`);
    } else {
      console.error(`โ ุฎุทุฃ ูู ุงูุตูุญุฉ ${pageNumber}: ${error.message}`);
    }
    return null;
  }
}

// ============================================
// ุงูุฏุงูุฉ ุงูุฑุฆูุณูุฉ (Main Function)
// ============================================

async function main() {
  const startTime = Date.now();
  
  // ุงูุญุตูู ุนูู book_id ูู ุงูู arguments ุฃู ุงุณุชุฎุฏุงู ุงููููุฉ ุงูุงูุชุฑุงุถูุฉ
  const bookId = process.argv[2] || DEFAULT_BOOK_ID;
  
  console.log('โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ');
  console.log('๐ ุณูุฑูุจุช ุณุญุจ ูุญุชูู ูุชุงุจ ูู Turath.io');
  console.log('โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ');
  console.log(`๐ ูุนุฑู ุงููุชุงุจ: ${bookId}\n`);
  
  try {
    // ============================================
    // 1. ุฌูุจ ูุนูููุงุช ุงููุชุงุจ
    // ============================================
    const bookInfo = await getBookInfo(bookId);
    
    if (!bookInfo || !bookInfo.meta) {
      throw new Error('ูู ูุชู ุงูุนุซูุฑ ุนูู ูุนูููุงุช ุงููุชุงุจ');
    }
    
    const bookName = bookInfo.meta.name || `ูุชุงุจ_${bookId}`;
    const totalPages = bookInfo.meta.pages || 'ุบูุฑ ูุนุฑูู';
    
    console.log(`โ ุชู ุฌูุจ ูุนูููุงุช ุงููุชุงุจ ุจูุฌุงุญ`);
    console.log(`๐ ุงุณู ุงููุชุงุจ: ${bookName}`);
    console.log(`๐ ุนุฏุฏ ุงูุตูุญุงุช ุงููุชููุน: ${totalPages}\n`);
    
    // ============================================
    // 2. ุฅุนุฏุงุฏ ุงูููู
    // ============================================
    
    // ุฅูุดุงุก ูุฌูุฏ ุงููุชุจ ุฅุฐุง ูู ููู ููุฌูุฏุงู
    await fs.mkdir(OUTPUT_DIR, { recursive: true });
    
    const sanitizedName = sanitizeFilename(bookName);
    const filename = `${sanitizedName}.txt`;
    const filepath = path.join(OUTPUT_DIR, filename);
    
    // ุฅูุดุงุก ุงูููู ูุน header
    const header = `${'โ'.repeat(60)}\n` +
                   `${bookName}\n` +
                   `${'โ'.repeat(60)}\n` +
                   `ูุนุฑู ุงููุชุงุจ: ${bookId}\n` +
                   `ุชุงุฑูุฎ ุงูุชุญููู: ${new Date().toLocaleString('ar-EG')}\n` +
                   `${'โ'.repeat(60)}\n\n`;
    
    await fs.writeFile(filepath, header, 'utf8');
    console.log(`๐ ุชู ุฅูุดุงุก ุงูููู: ${filename}\n`);
    
    // ============================================
    // 3. ุญููุฉ ุฌูุจ ุงูุตูุญุงุช
    // ============================================
    
    let pageNumber = 1;
    let successfulPages = 0;
    let emptyPages = 0;
    
    console.log('๐ ุจุฏุก ุชุญููู ุงูุตูุญุงุช...\n');
    
    while (true) {
      // ุฌูุจ ูุญุชูู ุงูุตูุญุฉ
      const pageData = await getPageContent(bookId, pageNumber);
      
      // ุฅุฐุง ูุดู ุงูุทูุจุ ูุนุชุจุฑูุง ููุงูุฉ ุงููุชุงุจ
      if (!pageData) {
        console.log(`\nโ๏ธ  ุชููู ุงูุชุญููู ุนูุฏ ุงูุตูุญุฉ ${pageNumber}`);
        break;
      }
      
      // ุฅุฐุง ูุงู ุงููุต ูุงุฑุบุงูุ ูุนุชุจุฑูุง ููุงูุฉ ุงููุชุงุจ
      const pageText = cleanText(pageData.text);
      if (!pageText || pageText.length === 0) {
        emptyPages++;
        console.log(`โ๏ธ  ุงูุตูุญุฉ ${pageNumber} ูุงุฑุบุฉ`);
        
        // ุฅุฐุง ูุฌุฏูุง 3 ุตูุญุงุช ูุงุฑุบุฉ ูุชุชุงููุฉุ ูุชููู
        if (emptyPages >= 3) {
          console.log(`\nโ๏ธ  ุชู ุงูุนุซูุฑ ุนูู ${emptyPages} ุตูุญุงุช ูุงุฑุบุฉ ูุชุชุงููุฉ - ููุงูุฉ ุงููุชุงุจ`);
          break;
        }
        
        pageNumber++;
        await sleep(DELAY_MS);
        continue;
      }
      
      // ุฅุนุงุฏุฉ ุชุนููู ุนุฏุงุฏ ุงูุตูุญุงุช ุงููุงุฑุบุฉ
      emptyPages = 0;
      
      // ุฅุถุงูุฉ ูุญุชูู ุงูุตูุญุฉ ุฅูู ุงูููู
      const separator = `\n${'โ'.repeat(60)}\n` +
                       `ุตูุญุฉ ${pageNumber}\n` +
                       `${'โ'.repeat(60)}\n\n`;
      
      await fs.appendFile(filepath, separator + pageText + '\n', 'utf8');
      successfulPages++;
      
      // ุนุฑุถ ุงูุชูุฏู ูู 10 ุตูุญุงุช
      if (pageNumber % 10 === 0) {
        console.log(`โ ุชู ุชุญููู ${pageNumber} ุตูุญุฉ...`);
      }
      
      // ุงูุงูุชูุงู ููุตูุญุฉ ุงูุชุงููุฉ
      pageNumber++;
      
      // ุงูุชุฃุฎูุฑ ูุจู ุงูุทูุจ ุงูุชุงูู
      await sleep(DELAY_MS);
    }
    
    // ============================================
    // 4. ุฑุณุงูุฉ ุงููุฌุงุญ ูุงูุฅุญุตุงุฆูุงุช
    // ============================================
    
    const endTime = Date.now();
    const duration = endTime - startTime;
    
    console.log('\nโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ');
    console.log('โ ุงูุชูู ุงูุชุญููู ุจูุฌุงุญ!');
    console.log('โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ');
    console.log(`๐ ุนุฏุฏ ุงูุตูุญุงุช ุงููุญููุฉ: ${successfulPages}`);
    console.log(`๐พ ุชู ุงูุญูุธ ูู: ${filepath}`);
    console.log(`โฑ๏ธ  ุงูููุช ุงููุณุชุบุฑู: ${formatDuration(duration)}`);
    console.log('โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ\n');
    
  } catch (error) {
    console.error('\nโ ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ุชูููุฐ ุงูุณูุฑูุจุช:');
    console.error(error.message);
    console.error('\nุชูุงุตูู ุงูุฎุทุฃ:');
    console.error(error);
    process.exit(1);
  }
}

// ============================================
// ุชุดุบูู ุงูุณูุฑูุจุช
// ============================================

// ุงูุชุนุงูู ูุน ุงูุฃุฎุทุงุก ุบูุฑ ุงููุชููุนุฉ
process.on('unhandledRejection', (error) => {
  console.error('\nโ ุฎุทุฃ ุบูุฑ ูุชููุน:');
  console.error(error);
  process.exit(1);
});

// ุชุดุบูู ุงูุฏุงูุฉ ุงูุฑุฆูุณูุฉ
main();
```

---

## ๐ ุทุฑููุฉ ุงูุงุณุชุฎุฏุงู

### 1. ุงูุชุญุถูุฑ

```bash
# ุฅูุดุงุก ูุฌูุฏ ุงููุดุฑูุน
mkdir turath-scraper
cd turath-scraper

# ุฅูุดุงุก package.json
npm init -y

# ุชุซุจูุช ุงูููุชุจุงุช ุงููุทููุจุฉ
npm install axios

# ุญูุธ ุงูุณูุฑูุจุช ูู ููู
# ุงูุณุฎ ุงูููุฏ ุฃุนูุงู ูุถุนู ูู ููู ุงุณูู turath_scraper.js
```

### 2. ุงูุชุดุบูู

#### ุงูุทุฑููุฉ ุงูุฃููู: ุงุณุชุฎุฏุงู book_id ูู ุงูููุฏ

```bash
node turath_scraper.js
```

#### ุงูุทุฑููุฉ ุงูุซุงููุฉ: ุชูุฑูุฑ book_id ูู argument

```bash
node turath_scraper.js 147927
```

### 3. ุงููุชูุฌุฉ

ุณูุชู ุฅูุดุงุก ูุฌูุฏ `books` ูุญุชูู ุนูู ููู ูุตู ุจุงุณู ุงููุชุงุจ:

```
turath-scraper/
โโโ node_modules/
โโโ books/
โ   โโโ ุงุณู_ุงููุชุงุจ.txt
โโโ package.json
โโโ turath_scraper.js
```

---

## ๐ ูุซุงู ุนูู ุงูุฅุฎุฑุงุฌ (Output)

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
๐ ุณูุฑูุจุช ุณุญุจ ูุญุชูู ูุชุงุจ ูู Turath.io
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
๐ ูุนุฑู ุงููุชุงุจ: 147927

๐ก ุฌุงุฑู ุฌูุจ ูุนูููุงุช ุงููุชุงุจ (ูุญุงููุฉ 1/3)...
โ ุชู ุฌูุจ ูุนูููุงุช ุงููุชุงุจ ุจูุฌุงุญ
๐ ุงุณู ุงููุชุงุจ: ุตุญูุญ ุงูุจุฎุงุฑู
๐ ุนุฏุฏ ุงูุตูุญุงุช ุงููุชููุน: 500

๐ ุชู ุฅูุดุงุก ุงูููู: ุตุญูุญ_ุงูุจุฎุงุฑู.txt

๐ ุจุฏุก ุชุญููู ุงูุตูุญุงุช...

โ ุชู ุชุญููู 10 ุตูุญุฉ...
โ ุชู ุชุญููู 20 ุตูุญุฉ...
โ ุชู ุชุญููู 30 ุตูุญุฉ...
...
โ ุชู ุชุญููู 500 ุตูุญุฉ...

โ๏ธ  ุชููู ุงูุชุญููู ุนูุฏ ุงูุตูุญุฉ 501

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ ุงูุชูู ุงูุชุญููู ุจูุฌุงุญ!
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
๐ ุนุฏุฏ ุงูุตูุญุงุช ุงููุญููุฉ: 500
๐พ ุชู ุงูุญูุธ ูู: ./books/ุตุญูุญ_ุงูุจุฎุงุฑู.txt
โฑ๏ธ  ุงูููุช ุงููุณุชุบุฑู: 4 ุฏูููุฉ ู 12 ุซุงููุฉ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

## ๐ง ุงูุชุฎุตูุตุงุช ุงููุชุงุญุฉ

### ุชุบููุฑ ุงูุชุฃุฎูุฑ ุจูู ุงูุทูุจุงุช

```javascript
const DELAY_MS = 1000; // 1 ุซุงููุฉ ุจุฏูุงู ูู 0.5
```

### ุชุบููุฑ ูุฌูุฏ ุงูุญูุธ

```javascript
const OUTPUT_DIR = './my_books';
```

### ุฅุถุงูุฉ ุงูุชุงุฑูุฎ ูุงุณู ุงูููู

```javascript
const timestamp = new Date().toISOString().split('T')[0];
const filename = `${sanitizedName}_${timestamp}.txt`;
```

### ุชุบููุฑ ุนุฏุฏ ูุญุงููุงุช ุฅุนุงุฏุฉ ุงูุทูุจ

```javascript
const MAX_RETRIES = 5;
```

---

## โ๏ธ ููุงุญุธุงุช ูููุฉ

### 1. ุงูุงุณุชุฎุฏุงู ุงูุฃุฎูุงูู

- โ ุงุณุชุฎุฏู ุงูุณูุฑูุจุช ููุท ูููุชุจ ุงูุชู ูุฏูู ุญู ุงููุตูู ุฅูููุง
- โ ุงุญุชุฑู ุดุฑูุท ุงุณุชุฎุฏุงู ุงููููุน
- โ ูุง ุชุณุชุฎุฏู ุงูุณูุฑูุจุช ูุฃุบุฑุงุถ ุชุฌุงุฑูุฉ ุฏูู ุฅุฐู

### 2. ุงูุฃุฏุงุก

- โฑ๏ธ ูุชุงุจ ูู 500 ุตูุญุฉ ูุณุชุบุฑู ~4-5 ุฏูุงุฆู
- ๐ ุณุฑุนุฉ ุงูุชุญููู ุชุนุชูุฏ ุนูู ุณุฑุนุฉ ุงูุฅูุชุฑูุช ูุงุณุชุฌุงุจุฉ ุงูุฎุงุฏู
- ๐พ ุญุฌู ุงูููู ุงูููุงุฆู ูุนุชูุฏ ุนูู ูุญุชูู ุงููุชุงุจ

### 3. ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก

- ๐ ุงูุณูุฑูุจุช ูุนูุฏ ุงููุญุงููุฉ 3 ูุฑุงุช ุนูุฏ ูุดู ุงูุทูุจ
- โ๏ธ ุฅุฐุง ูุดูุช ูู ุงููุญุงููุงุชุ ูุชููู ุงูุณูุฑูุจุช
- ๐ ูุชู ุญูุธ ูุง ุชู ุชุญูููู ุญุชู ูู ุชููู ุงูุณูุฑูุจุช

### 4. ุงููููุฏ

- โ ูุง ูุฏุนู ุงุณุชุฆูุงู ุงูุชุญููู (Resume)
- โ ูุง ูุฏุนู ุงูุชุญููู ุงููุชูุงุฒู (Parallel Downloads)
- โ ูุง ูุญูุธ ุงูุตูุฑ ุฃู ุงููุณุงุฆุท ุงููุชุนุฏุฏุฉ

---

## ๐ฏ ุงูุชุญุณููุงุช ุงููุณุชูุจููุฉ ุงูููููุฉ

### 1. ุงุณุชุฆูุงู ุงูุชุญููู (Resume Support)

```javascript
// ุญูุธ ุงูุชูุฏู ูู ููู JSON
const progressFile = `${sanitizedName}_progress.json`;
await fs.writeFile(progressFile, JSON.stringify({
  lastPage: pageNumber,
  totalPages: successfulPages
}));
```

### 2. ุดุฑูุท ุชูุฏู ูุชูุฏู

```bash
npm install cli-progress
```

```javascript
const cliProgress = require('cli-progress');
const progressBar = new cliProgress.SingleBar({}, cliProgress.Presets.shades_classic);
progressBar.start(totalPages, 0);
// ... ูู ุงูุญููุฉ
progressBar.update(pageNumber);
```

### 3. ุญูุธ ุจุตูุบ ูุชุนุฏุฏุฉ

- PDF ุจุงุณุชุฎุฏุงู `pdfkit`
- EPUB ุจุงุณุชุฎุฏุงู `epub-gen`
- Markdown ููุชูุณูู ุงูุฃูุถู

### 4. ูุงุฌูุฉ ุณุทุฑ ุฃูุงูุฑ ุชูุงุนููุฉ

```bash
npm install inquirer
```

```javascript
const inquirer = require('inquirer');

const answers = await inquirer.prompt([
  {
    type: 'input',
    name: 'bookId',
    message: 'ุฃุฏุฎู ูุนุฑู ุงููุชุงุจ:',
  },
  {
    type: 'list',
    name: 'format',
    message: 'ุงุฎุชุฑ ุตูุบุฉ ุงูุญูุธ:',
    choices: ['TXT', 'PDF', 'EPUB'],
  },
]);
```

### 5. ูุงุนุฏุฉ ุจูุงูุงุช ูููุชุจ ุงููุญููุฉ

```javascript
// SQLite ูุชุชุจุน ุงููุชุจ ุงููุญููุฉ
const sqlite3 = require('sqlite3');
const db = new sqlite3.Database('books.db');

db.run(`CREATE TABLE IF NOT EXISTS books (
  id INTEGER PRIMARY KEY,
  book_id INTEGER,
  name TEXT,
  pages INTEGER,
  download_date TEXT,
  file_path TEXT
)`);
```

---

## ๐ ุงุณุชูุดุงู ุงูุฃุฎุทุงุก ูุญููุง

### ุงููุดููุฉ: "Cannot find module 'axios'"

**ุงูุญู**:

```bash
npm install axios
```

### ุงููุดููุฉ: "ENOENT: no such file or directory"

**ุงูุญู**: ุชุฃูุฏ ูู ุฃู ุงููุฌูุฏ ุงูุญุงูู ุตุญูุญ

```bash
pwd  # Linux/Mac
cd   # Windows
```

### ุงููุดููุฉ: "Request timeout"

**ุงูุญู**: ุฒูุงุฏุฉ ููุช ุงูุงูุชุธุงุฑ

```javascript
timeout: 30000, // 30 ุซุงููุฉ
```

### ุงููุดููุฉ: "429 Too Many Requests"

**ุงูุญู**: ุฒูุงุฏุฉ ุงูุชุฃุฎูุฑ ุจูู ุงูุทูุจุงุช

```javascript
const DELAY_MS = 2000; // 2 ุซุงููุฉ
```

### ุงููุดููุฉ: ุงูููู ูุญุชูู ุนูู ุฑููุฒ ุบุฑูุจุฉ

**ุงูุญู**: ุชุฃูุฏ ูู ุงูุชุฑููุฒ UTF-8

```javascript
await fs.writeFile(filepath, content, { encoding: 'utf8' });
```

---

## ๐ ุงููุฑุงุฌุน ูุงูููุงุฑุฏ

### ุงูููุชุจุงุช ุงููุณุชุฎุฏูุฉ

- [Axios Documentation](https://axios-http.com/docs/intro)
- [Node.js fs/promises](https://nodejs.org/api/fs.html#promises-api)

### ููุงูุงุช ุฐุงุช ุตูุฉ

- [Web Scraping Best Practices](https://www.scrapehero.com/web-scraping-best-practices/)
- [Rate Limiting in Node.js](https://blog.logrocket.com/rate-limiting-node-js/)

---

## ๐ ุงูุชุฑุฎูุต

ูุฐุง ุงูุณูุฑูุจุช ููุฏู ููุง ูู ููุฃุบุฑุงุถ ุงูุชุนููููุฉ. ุงุณุชุฎุฏูู ุจูุณุคูููุฉ ูุงุญุชุฑู ุญููู ุงูููููุฉ ุงูููุฑูุฉ.

---

## โ๏ธ ุงูุฎูุงุตุฉ

ูุฐุง ุงูุณูุฑูุจุช ูููุฑ:

- โ ุทุฑููุฉ ุจุณูุทุฉ ููุนุงูุฉ ูุชุญููู ุงููุชุจ
- โ ูุนุงูุฌุฉ ุดุงููุฉ ููุฃุฎุทุงุก
- โ ุชูุฏู ูุงุถุญ ููุนูููุงุช ูููุฏุฉ
- โ ููุฏ ูุธูู ูููุซู ุฌูุฏุงู
- โ ูุงุจู ููุชุฎุตูุต ูุงูุชูุณุน

**ุฌุงูุฒ ููุงุณุชุฎุฏุงู ุงูููุฑู!** ๐
