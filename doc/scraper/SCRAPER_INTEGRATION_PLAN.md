# ๐ ุฎุทุฉ ุฏูุฌ ุณูุฑุจุช ุณุญุจ ุงููุชุจ ูุน ูุงุนุฏุฉ ุงูุจูุงูุงุช

**ุชุงุฑูุฎ ุงูุฅูุดุงุก:** 2026-01-18  
**ุงูุญุงูุฉ:** ููุฏ ุงูุชุฎุทูุท

---

## ๐ ููุฎุต ุงูุชุญููู

### ุงููููุงุช ุงูููุฌูุฏุฉ

| ุงูููู | ุงููุตู | ุงูุญุงูุฉ |
|------|-------|-------|
| [`turath_scraper_discussion.md`](file:///c:/Users/osaid/Documents/BMS_alkamelah/doc/scraper/turath_scraper_discussion.md) | ุณูุฑุจุช Node.js ูุงูู ูุณุญุจ ุงููุชุจ ูู Turath.io | โ ุฌุงูุฒ |
| [`turath_api_features.md`](file:///c:/Users/osaid/Documents/BMS_alkamelah/doc/scraper/turath_api_features.md) | ููุฒุงุช ุฅุถุงููุฉ ููุชุดูุฉ ูู API | โ ุฌุงูุฒ |
| [`DATABASE_STRUCTURE_GUIDE.md`](file:///c:/Users/osaid/Documents/BMS_alkamelah/doc/dataBase/DATABASE_STRUCTURE_GUIDE.md) | ุฏููู ุจููุฉ ูุงุนุฏุฉ ุงูุจูุงูุงุช | โ๏ธ ูุงุฑุบ - ูุญุชุงุฌ ุฅูุดุงุก |

---

## ๐ฏ ุฑุฃูู ูู ุงููููุงุช ุงูุญุงููุฉ

### โ ููุงุท ุงูููุฉ

1. **ุณูุฑุจุช Turath.io ูุชูุงูู:**
   - ุชุญููู ุดุงูู ููู API
   - ูุนุงูุฌุฉ ุฃุฎุทุงุก ููุชุงุฒุฉ (Retry Logic ูุน Exponential Backoff)
   - ุชุฃุฎูุฑ ุฒููู ููุงุณุจ (500ms) ูุชุฌูุจ ุงูุญุธุฑ
   - ุฏุนู ุงุณุชุฎุฑุงุฌ: ุงููุญุชููุ ุงูููุฑุณุ ุจูุงูุงุช ุงููุคููุ ุงููุญูู

2. **ููุฒุงุช ูุชูุฏูุฉ ููุชุดูุฉ:**
   - `volume_bounds`: ูุนุฑูุฉ ุนุฏุฏ ุงูุตูุญุงุช ุจุงูุถุจุท
   - `headings`: ููุฑุณ ุงููุชุงุจ ุงููุงูู
   - `meta.info`: ูุนูููุงุช ุงููุคูู ูุงููุญูู

3. **ููุฏ ูุธูู ูููุซู:**
   - ุชุนูููุงุช ูุงุถุญุฉ ุจุงูุนุฑุจู
   - ุจููุฉ ูุนูุงุฑูุฉ ููุธูุฉ
   - ูุงุจู ููุชุฎุตูุต

### โ๏ธ ููุงุท ุชุญุชุงุฌ ุชุญุณูู

1. **ุงูุณูุฑุจุช ูุญูุธ ูู ูููุงุช TXT ููุท:**
   - โ ูุง ูุฏุฎู ุงูุจูุงูุงุช ูุจุงุดุฑุฉ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
   - โ ูุง ูุณุชููุฏ ูู ุจููุฉ Laravel/Eloquent

2. **ูุง ููุฌุฏ ุฑุจุท ูุน ุงูููุงุฐุฌ:**
   - โ ูุง ุชูุฌุฏ ุขููุฉ ูุฅูุดุงุก `Book`, `Author`, `Chapter`, `Page`
   - โ ูุง ูุณุชุฎุฏู ุงูุนูุงูุงุช ุจูู ุงูุฌุฏุงูู

3. **ููู DATABASE_STRUCTURE_GUIDE.md ูุงุฑุบ:**
   - โ ูุง ููุฌุฏ ุชูุซูู ููุฌุฏุงูู ูุงูุนูุงูุงุช

---

## ๐ ุงูุจูุงูุงุช ุงููุชุงุญุฉ ูู Turath.io API

### 1. ูุนูููุงุช ุงููุชุงุจ (`/book?id={id}&include=indexes`)

```json
{
  "meta": {
    "id": 147927,
    "name": "ุงุณู ุงููุชุงุจ",
    "type": 5,
    "printed": 3,
    "info": "ุงููุชุงุจ: ...\\nุงููุคูู: ...\\nุงููุญูู: ...\\nุนุฏุฏ ุงูุตูุญุงุช: ูฆูง",
    "author_id": 44,
    "cat_id": "6"
  },
  "indexes": {
    "volumes": ["1", "2"],
    "headings": [
      { "title": "ุนููุงู ุงููุตู", "level": 1, "page": 5 }
    ],
    "volume_bounds": {
      "1": [1, 300],
      "2": [301, 600]
    }
  }
}
```

### 2. ูุญุชูู ุงูุตูุญุฉ (`/page?book_id={id}&pg={page}`)

```json
{
  "text": "ูุญุชูู ุงูุตูุญุฉ...",
  "page": 1
}
```

---

## ๐ ุงููุทุงุจูุฉ ูุน ูุงุนุฏุฉ ุงูุจูุงูุงุช

### ุฌุฏูู ุงููุทุงุจูุฉ

| ุจูุงูุงุช Turath.io | ุฌุฏูู ูุงุนุฏุฉ ุงูุจูุงูุงุช | ุงูุญููู |
|-----------------|-------------------|--------|
| `meta.id` | `books` | `shamela_id` (ูููู ุงุณุชุฎุฏุงูู ููุนุฑู ุฎุงุฑุฌู) |
| `meta.name` | `books` | `title` |
| `meta.info` (parsed) | `books` + `authors` + `publishers` | ุจูุงูุงุช ูุชูุฑูุฉ |
| `meta.cat_id` | `book_sections` | `id` (ูุญุชุงุฌ mapping) |
| `indexes.volumes` | `volumes` | `number` |
| `indexes.volume_bounds` | `volumes` | `page_start`, `page_end` |
| `indexes.headings` | `chapters` | `title`, `level`, `page_start` |
| `page.text` | `pages` | `content` |

---

## ๐ ุฎุทุฉ ุงูุนูู ุงูููุชุฑุญุฉ

### ุงููุฑุญูุฉ 1: ุฅุนุฏุงุฏ ุงูุจููุฉ ุงูุฃุณุงุณูุฉ ๐ง

**ุงููุฏุฉ:** ููู ูุงุญุฏ

#### 1.1 ุฅูุดุงุก ููู ุฏููู ูุงุนุฏุฉ ุงูุจูุงูุงุช

- [ ] ููุก ููู `DATABASE_STRUCTURE_GUIDE.md` ุจุชูุงุตูู ุงูุฌุฏุงูู
- [ ] ุชูุซูู ุงูุนูุงูุงุช ุจูู ุงูุฌุฏุงูู
- [ ] ุฅุถุงูุฉ ุฃูุซูุฉ ุนูู ุงูู Queries

#### 1.2 ุฅูุดุงุก ูุฌูุฏ ุงูุณูุฑุจุชุงุช

```
app/
โโโ Console/
โ   โโโ Commands/
โ       โโโ ImportTurathBook.php    โ ุฃูุฑ Artisan
โโโ Services/
โ   โโโ TurathScraperService.php    โ ุฎุฏูุฉ ุงูุณุญุจ
```

---

### ุงููุฑุญูุฉ 2: ุชุทููุฑ ุณูุฑุจุช Laravel ๐๏ธ

**ุงููุฏุฉ:** 2-3 ุฃูุงู

#### 2.1 ุฅูุดุงุก Service Class

```php
// app/Services/TurathScraperService.php

class TurathScraperService
{
    protected $httpClient;
    protected $baseUrl = 'https://api.turath.io';
    protected $delay = 500; // ms
    
    public function getBookInfo(int $bookId): array { }
    public function getPageContent(int $bookId, int $pageNumber): ?string { }
    public function importBook(int $turathBookId): Book { }
}
```

#### 2.2 ุฅูุดุงุก Artisan Command

```php
// app/Console/Commands/ImportTurathBook.php

class ImportTurathBook extends Command
{
    protected $signature = 'turath:import {book_id}';
    protected $description = 'ุงุณุชูุฑุงุฏ ูุชุงุจ ูู Turath.io';
    
    public function handle(TurathScraperService $scraper) { }
}
```

#### 2.3 ุงูููุฒุงุช ุงููุทููุจุฉ

| ุงูููุฒุฉ | ุงูุฃููููุฉ | ุงูุญุงูุฉ |
|-------|---------|-------|
| ุฌูุจ ูุนูููุงุช ุงููุชุงุจ ูุญูุธูุง | ๐ด ุนุงููุฉ | โณ |
| ุงุณุชุฎุฑุงุฌ ุงููุคูู ูุฑุจุทู | ๐ด ุนุงููุฉ | โณ |
| ุฅูุดุงุก ุงููุฌูุฏุงุช | ๐ก ูุชูุณุทุฉ | โณ |
| ุฅูุดุงุก ุงููุตูู ูู `headings` | ๐ก ูุชูุณุทุฉ | โณ |
| ุณุญุจ ูุญูุธ ุงูุตูุญุงุช (Batch) | ๐ด ุนุงููุฉ | โณ |
| ุดุฑูุท ุชูุฏู | ๐ข ููุฎูุถุฉ | โณ |
| ุงุณุชุฆูุงู ุงูุชุญููู | ๐ข ููุฎูุถุฉ | โณ |

---

### ุงููุฑุญูุฉ 3: ูุนุงูุฌุฉ ุงูุจูุงูุงุช ๐

**ุงููุฏุฉ:** ููู ูุงุญุฏ

#### 3.1 ุงุณุชุฎุฑุงุฌ ุงูุจูุงูุงุช ูู `meta.info`

```php
class MetadataParser
{
    public function parse(string $info): array
    {
        return [
            'book_name' => $this->extractField($info, 'ุงููุชุงุจ'),
            'author_name' => $this->extractField($info, 'ุงููุคูู'),
            'editor_name' => $this->extractField($info, 'ุงููุญูู'),
            'reviewer_name' => $this->extractField($info, 'ุฑุงุฌุนูุง'),
            'pages_count' => $this->extractArabicNumber($info, 'ุนุฏุฏ ุงูุตูุญุงุช'),
        ];
    }
}
```

#### 3.2 ูุทุงุจูุฉ ุงูุฃูุณุงู (Category Mapping)

```php
// Mapping ูู cat_id ูู Turath ุฅูู book_section_id ูู ูุงุนุฏุชูุง
$categoryMapping = [
    '1' => 5,  // ุงูุนููุฏุฉ
    '2' => 10, // ุงูููู
    '6' => 3,  // ุงูุญุฏูุซ
    // ...
];
```

#### 3.3 ุงูุจุญุซ ุนู ุงููุคูููู ุงูููุฌูุฏูู

```php
// ุงูุจุญุซ ุนู ูุคูู ููุฌูุฏ ุฃู ุฅูุดุงุก ุฌุฏูุฏ
$author = Author::firstOrCreate(
    ['full_name' => $extractedAuthorName],
    [
        'is_living' => false,
        // ... ุจูุงูุงุช ุฃุฎุฑู
    ]
);
```

---

### ุงููุฑุญูุฉ 4: ุญูุธ ุงูุจูุงูุงุช ๐พ

**ุงููุฏุฉ:** ููู ูุงุญุฏ

#### 4.1 ุชุฏูู ุงูุญูุธ

```mermaid
flowchart TD
    A[ุจุฏุก ุงูุงุณุชูุฑุงุฏ] --> B[ุฌูุจ ูุนูููุงุช ุงููุชุงุจ]
    B --> C[ุงุณุชุฎุฑุงุฌ ุงูุจูุงูุงุช ุงููุตููุฉ]
    C --> D{ุงููุคูู ููุฌูุฏุ}
    D -->|ูุนู| E[ุฑุจุท ุงููุคูู]
    D -->|ูุง| F[ุฅูุดุงุก ูุคูู ุฌุฏูุฏ]
    F --> E
    E --> G[ุฅูุดุงุก ุงููุชุงุจ]
    G --> H[ุฅูุดุงุก ุงููุฌูุฏุงุช]
    H --> I[ุฅูุดุงุก ุงููุตูู]
    I --> J[ุณุญุจ ุงูุตูุญุงุช]
    J --> K{ูู ุงูุตูุญุงุชุ}
    K -->|ูุง| L[ุญูุธ ุฏูุนุฉ]
    L --> J
    K -->|ูุนู| M[ุงูุชูุงุก]
```

#### 4.2 ุญูุธ ุงูุตูุญุงุช ุจุงูุฏูุนุงุช (Batch Insert)

```php
// ุญูุธ 500 ุตูุญุฉ ุฏูุนุฉ ูุงุญุฏุฉ
$pages = [];
foreach ($pagesData as $pageData) {
    $pages[] = [
        'book_id' => $book->id,
        'volume_id' => $volumeId,
        'page_number' => $pageData['page'],
        'content' => $pageData['text'],
        'created_at' => now(),
        'updated_at' => now(),
    ];
    
    if (count($pages) >= 500) {
        Page::insert($pages);
        $pages = [];
    }
}

// ุญูุธ ุงูุจุงูู
if (!empty($pages)) {
    Page::insert($pages);
}
```

---

### ุงููุฑุญูุฉ 5: ุงูุงุฎุชุจุงุฑ ูุงูุชูุซูู โ

**ุงููุฏุฉ:** ููู ูุงุญุฏ

#### 5.1 ุงุฎุชุจุงุฑ ุงูุณูุฑุจุช

```bash
# ุงุฎุชุจุงุฑ ุนูู ูุชุงุจ ุตุบูุฑ (ุงูุฃุฑุจุนูู ุงูููููุฉ)
php artisan turath:import 147927

# ุงุฎุชุจุงุฑ ุนูู ูุชุงุจ ูุชูุณุท
php artisan turath:import 12345

# ุงุฎุชุจุงุฑ ุนูู ูุชุงุจ ูุจูุฑ (ุตุญูุญ ุงูุจุฎุงุฑู)
php artisan turath:import 99999
```

#### 5.2 ุชูุซูู ุงูุงุณุชุฎุฏุงู

```markdown
## ุงุณุชุฎุฏุงู ุงูุณูุฑุจุช

### ุงูุงุณุชูุฑุงุฏ ุงูุฃุณุงุณู
php artisan turath:import {book_id}

### ุฎูุงุฑุงุช ุฅุถุงููุฉ
php artisan turath:import {book_id} --dry-run     # ูุนุงููุฉ ุจุฏูู ุญูุธ
php artisan turath:import {book_id} --skip-pages  # ุงุณุชูุฑุงุฏ ุจุฏูู ุตูุญุงุช
php artisan turath:import {book_id} --force       # ุฅุนุงุฏุฉ ุงูุงุณุชูุฑุงุฏ
```

---

## ๐ ูููู ุงููููุงุช ุงูููุชุฑุญ

```
app/
โโโ Console/
โ   โโโ Commands/
โ       โโโ ImportTurathBook.php         โ ุฃูุฑ ุงูุงุณุชูุฑุงุฏ
โ       โโโ ImportTurathBooksFromList.php โ ุงุณุชูุฑุงุฏ ูุงุฆูุฉ ูุชุจ
โโโ Services/
โ   โโโ TurathScraperService.php         โ ุฎุฏูุฉ ุงูุณุญุจ ุงูุฑุฆูุณูุฉ
โ   โโโ MetadataParserService.php        โ ุชุญููู ุงูุจูุงูุงุช ุงููุตููุฉ
โโโ Jobs/
    โโโ ImportTurathBookJob.php          โ ูููุนุงูุฌุฉ ูู ุงูุฎูููุฉ

doc/
โโโ dataBase/
โ   โโโ DATABASE_STRUCTURE_GUIDE.md      โ ุฏููู ูุงุนุฏุฉ ุงูุจูุงูุงุช
โโโ scraper/
    โโโ turath_scraper_discussion.md     โ (ููุฌูุฏ)
    โโโ turath_api_features.md           โ (ููุฌูุฏ)
    โโโ SCRAPER_INTEGRATION_PLAN.md      โ ูุฐุง ุงูููู
```

---

## โฑ๏ธ ุงูุฌุฏูู ุงูุฒููู

| ุงููุฑุญูุฉ | ุงููุฏุฉ | ุชุงุฑูุฎ ุงูุจุฏุก | ุชุงุฑูุฎ ุงูุงูุชูุงุก |
|--------|------|------------|---------------|
| ุงููุฑุญูุฉ 1: ุงูุจููุฉ ุงูุฃุณุงุณูุฉ | 1 ููู | - | - |
| ุงููุฑุญูุฉ 2: ุชุทููุฑ ุงูุณูุฑุจุช | 3 ุฃูุงู | - | - |
| ุงููุฑุญูุฉ 3: ูุนุงูุฌุฉ ุงูุจูุงูุงุช | 1 ููู | - | - |
| ุงููุฑุญูุฉ 4: ุญูุธ ุงูุจูุงูุงุช | 1 ููู | - | - |
| ุงููุฑุญูุฉ 5: ุงูุงุฎุชุจุงุฑ | 1 ููู | - | - |
| **ุงูุฅุฌูุงูู** | **7 ุฃูุงู** | - | - |

---

## ๐ฏ ุงูุฃููููุงุช

### ุงูุขู (ููุฑู) ๐ด

1. ููุก ููู `DATABASE_STRUCTURE_GUIDE.md`
2. ุฅูุดุงุก `TurathScraperService.php`
3. ุฅูุดุงุก ุฃูุฑ Artisan ุงูุฃุณุงุณู

### ูุฑูุจุงู (ูุฐุง ุงูุฃุณุจูุน) ๐ก

1. ูุนุงูุฌุฉ ุงูุจูุงูุงุช ุงููุตููุฉ
2. ุฑุจุท ุงููุคูููู ูุงูุฃูุณุงู
3. ุณุญุจ ูุญูุธ ุงูุตูุญุงุช

### ูุงุญูุงู (ุงูุฃุณุจูุน ุงููุงุฏู) ๐ข

1. ุดุฑูุท ุงูุชูุฏู ุงููุชูุฏู
2. ุงุณุชุฆูุงู ุงูุชุญููู
3. ุงููุนุงูุฌุฉ ูู ุงูุฎูููุฉ (Queue Jobs)

---

## โ ุงูุฎุทูุฉ ุงูุชุงููุฉ

1. **ุงูููุงููุฉ ุนูู ูุฐู ุงูุฎุทุฉ**
2. **ุชุญุฏูุฏ ุงูุฃููููุฉ:** ูู ูุจุฏุฃ ุจู:
   - ุฅูุดุงุก ููู ุฏููู ูุงุนุฏุฉ ุงูุจูุงูุงุชุ
   - ุฅูุดุงุก ุณูุฑุจุช Laravel ูุจุงุดุฑุฉุ
   - ุชุญููู ุงูุณูุฑุจุช Node.js ุงูุญุงููุ

---

**ุชู ุฅุนุฏุงุฏ ูุฐู ุงูุฎุทุฉ ุจุชุงุฑูุฎ:** 2026-01-18
